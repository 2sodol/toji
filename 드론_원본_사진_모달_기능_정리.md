# 드론 원본 사진 탐색 모달 (Drone Raw Photo Modal) 기능 명세

## 1. 개요 (Overview)
본 문서는 드론으로 촬영된 원본 사진을 날짜별로 조회하고, 지도 기반으로 위치를 확인하거나 리스트에서 선택하여 다운로드하는 `drone-raw-photo-modal` 모듈의 기능 및 동작 방식을 기술합니다.

*   **관련 파일**:
    *   `src/main/webapp/WEB-INF/views/drone-raw-photo-modal.jsp` (View)
    *   `src/main/webapp/resources/js/drone-raw-photo-modal.js` (Logic)
    *   `src/main/webapp/resources/css/drone-raw-photo-modal.css` (Style)

## 2. 주요 기능 및 UI 구조

### A. UI 레이아웃
*   **좌측 (Map)**: OpenLayers 기반의 지도 영역. 촬영된 사진의 위치를 마커로 표시.
*   **우측 (List)**: 선택된 날짜 및 현재 지도 화면 영역(Extent)에 포함된 사진 목록 표시.
    *   **헤더**: 총 개수, 날짜 선택 필터(`Select Box`), 전체 선택 체크박스, 선택 다운로드 버튼.
    *   **목록**: 사진 썸네일, 파일명, 촬영일, 주소(Reverse Geocoding), 개별 다운로드 버튼.
*   **이미지 뷰어**: 썸네일 클릭 시 원본 이미지를 팝업으로 상세 조회.

### B. 주요 동작 프로세스 (Logic Flow)

#### 1. 초기화 (Initialization)
*   **모달 오픈 (`window.openDrpModal`)**:
    *   모달 표시 (`#drp-modal` show).
    *   지도(`initMap`) 초기화 (최초 1회 실행, 이후 `updateSize`).
    *   **날짜 로딩 (`loadDates`)**: `/api/drone/dates`를 호출하여 촬영 데이터가 존재하는 날짜 목록을 가져옴.
        *   Default: 가장 최근 날짜 자동 선택.

#### 2. 데이터 조회 및 표출
*   **사진 데이터 로딩 (`loadPhotos(date)`)**:
    *   사용자가 날짜 선택 시 `/api/drone/photos?date={date}` 호출.
    *   응답받은 사진 데이터로 지도와 리스트를 갱신.
*   **지도 갱신 (`updateMap`)**:
    *   **마커 생성**: 사진의 GPS 좌표(Lon, Lat)를 기반으로 마커 생성.
    *   **클러스터링**: 밀집된 마커는 `ol.source.Cluster`를 사용하여 그룹화(숫자 표시).
    *   **자동 이동**: 데이터 로딩 직후, 첫 번째 사진의 위치로 지도 중심 이동 및 줌 레벨(18) 설정.
*   **리스트 갱신 (`updateList`)**:
    *   **필터링**: 지도 이동(`moveend`) 이벤트 발생 시, **현재 화면(Extent) 내에 위치한 사진만** 리스트에 표시.
    *   **주소 변환**: VWorld Reverse Geocoding API를 비동기로 호출하여 위경도를 주소로 변환 표시.

#### 3. 상호 작용 (Interaction)
*   **지도 -> 리스트**:
    *   지도 마커 클릭 시 해당 사진이 선택됨(Highlight).
    *   리스트에서 해당 아이템 위치로 자동 스크롤 이동.
*   **리스트 -> 지도**:
    *   리스트 아이템 클릭 시 지도가 해당 사진 위치로 애니메이션 이동.
    *   해당 마커 하이라이트(붉은색, z-index 상승).
*   **이미지 뷰어**:
    *   리스트의 썸네일 클릭 시 크게 보기 모달 오픈.

#### 4. 다운로드 (Download)
*   **개별 다운로드**: 리스트 내 '다운로드' 버튼 클릭. (`/api/drone/download/{seq}`)
*   **일괄 다운로드**: 체크박스로 복수 항목 선택 후 상단 '선택 다운로드' 버튼 클릭.
    *   Form Submit 방식으로 `/api/drone/download/zip` (POST) 호출.

## 3. API 의존성 (API Dependency)
> *Note: 향후 백엔드 변경 시 수정이 필요한 API 목록입니다.*

| 구분 | HTTP Method | URL | 설명 |
| :--- | :--- | :--- | :--- |
| **날짜 목록** | GET | `/api/drone/dates` | 촬영 데이터가 있는 날짜 목록 조회 |
| **사진 목록** | GET | `/api/drone/photos` | 특정 날짜의 사진 메타데이터(파일명, 좌표 등) 목록 조회 |
| **썸네일** | GET | `/api/drone/thumbnail/{photoSeq}` | 사진 미리보기 이미지 조회 |
| **개별 다운로드** | GET | `/api/drone/download/{photoSeq}` | 단일 파일 다운로드 |
| **일괄 다운로드** | POST | `/api/drone/download/zip` | 선택된 파일(ID 배열)을 ZIP으로 압축 다운로드 |
| **주소 변환** | JSONP | `api.vworld.kr/req/address` | 좌표를 주소로 변환 (Client Side API) |

## 4. 특이 사항
*   **지도 엔진**: VWorld 타일맵 + OpenLayers 사용.
*   **좌표계**: EPSG:4326 (Lon, Lat) 사용.
*   **주소 캐싱**: 기능 없음 (매번 API 호출).

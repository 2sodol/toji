# ğŸ—ºï¸ ì§€ë„ ì˜ì—­ í´ë¦­ ì‹œ íŒì—… ë° ì˜¤ë²„ë ˆì´ í‘œì¶œ ê¸°ëŠ¥ - ë°ì´í„° íë¦„ ìƒì„¸ ë¶„ì„

## ğŸ“‹ ëª©ì°¨

1. [ê¸°ëŠ¥ ê°œìš”](#1-ê¸°ëŠ¥-ê°œìš”)
2. [ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ê¸°ìˆ  ìŠ¤íƒ](#2-ì‚¬ìš©-ë¼ì´ë¸ŒëŸ¬ë¦¬-ë°-ê¸°ìˆ -ìŠ¤íƒ)
3. [ë°ì´í„° íë¦„ ë‹¨ê³„ë³„ ìƒì„¸ ë¶„ì„](#3-ë°ì´í„°-íë¦„-ë‹¨ê³„ë³„-ìƒì„¸-ë¶„ì„)
4. [ì£¼ì†Œ ì¡°íšŒ ì„œë¹„ìŠ¤](#4-ì£¼ì†Œ-ì¡°íšŒ-ì„œë¹„ìŠ¤)
5. [ì „ì²´ ë°ì´í„° íë¦„ ìš”ì•½](#5-ì „ì²´-ë°ì´í„°-íë¦„-ìš”ì•½)

---

## 1. ê¸°ëŠ¥ ê°œìš”

ì§€ë„ì—ì„œ í•„ì§€(ì§€ì í¸ì§‘ë„) ì˜ì—­ì„ í´ë¦­í•˜ë©´:

- í´ë¦­ ì§€ì ì˜ ì§€ì  ì •ë³´ë¥¼ ì¡°íšŒ
- ì„ íƒ ì˜ì—­ì„ í•˜ì´ë¼ì´íŠ¸ë¡œ í‘œì‹œ
- í•´ë‹¹ í•„ì§€ì˜ ì£¼ì†Œ ì •ë³´ë¥¼ íŒì—…ìœ¼ë¡œ í‘œì¶œ
- ë“±ë¡/ì¡°íšŒ ë²„íŠ¼ ì œê³µ

---

## 2. ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ê¸°ìˆ  ìŠ¤íƒ

### 2.1 ì§€ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬

**ë¼ì´ë¸ŒëŸ¬ë¦¬ëª…:** OpenLayers 3  
**ë²„ì „:** v3.20.1  
**CDN:** `https://openlayers.org/en/v3.20.1/build/ol.js`

**ì„¤ëª…:**  
OpenLayersëŠ” ì˜¤í”ˆì†ŒìŠ¤ JavaScript ì§€ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ë‹¤ì–‘í•œ ì§€ë„ íƒ€ì¼ ì†ŒìŠ¤ì™€ ë²¡í„° ë°ì´í„°ë¥¼ ë Œë”ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì§€ë„ ë Œë”ë§, ë ˆì´ì–´ ê´€ë¦¬, ì´ë²¤íŠ¸ ì²˜ë¦¬, íŒì—… ë° ì˜¤ë²„ë ˆì´ í‘œì‹œì— ì‚¬ìš©ë©ë‹ˆë‹¤.

### 2.2 íŒì—… ì˜¤ë²„ë ˆì´ - OpenLayers Overlay

**ì‚¬ìš© í´ë˜ìŠ¤:** `ol.Overlay`  
**ë¼ì´ë¸ŒëŸ¬ë¦¬:** OpenLayers 3 (v3.20.1)

**ê¸°ëŠ¥:**  
ì§€ë„ ìœ„ì— HTML ìš”ì†Œë¥¼ ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ì˜¤ë²„ë ˆì´ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. í´ë¦­í•œ ì§€ì ì´ë‚˜ íŠ¹ì • ì¢Œí‘œì— íŒì—… ì°½ì„ í‘œì‹œí•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

**ì½”ë“œ ìœ„ì¹˜:**

```965:970:src/main/webapp/WEB-INF/views/index.jsp
        window.popupOverlay = new ol.Overlay({
          element: container,
          autoPan: true,
          autoPanAnimation: { duration: 250 },
        });
        window.map.addOverlay(window.popupOverlay);
```

**ì£¼ìš” ì†ì„±:**

- `element`: HTML DOM ìš”ì†Œ (íŒì—… ì»¨í…Œì´ë„ˆ)
- `autoPan`: íŒì—…ì´ í™”ë©´ ë°–ì— ìˆì„ ë•Œ ì§€ë„ê°€ ìë™ìœ¼ë¡œ ì´ë™í•˜ëŠ”ì§€ ì—¬ë¶€
- `autoPanAnimation`: ìë™ íŒ¬ ì• ë‹ˆë©”ì´ì…˜ ì„¤ì • (duration: 250ms)

**ì‚¬ìš© ë°©ë²•:**

```javascript
// íŒì—… ìœ„ì¹˜ ì„¤ì •
window.popupOverlay.setPosition([x, y]); // ì¢Œí‘œ ë°°ì—´ (EPSG:3857)

// íŒì—… ìˆ¨ê¸°ê¸°
window.popupOverlay.setPosition(undefined);
```

**ê´€ë ¨ HTML ìš”ì†Œ:**

```42:56:src/main/webapp/WEB-INF/views/index.jsp
    <div id="ilgl-popup" class="ilgl-popup">
      <a href="#" id="ilgl-popup-closer" class="ilgl-popup-closer"></a>
      <div id="ilgl-popup-header" class="ilgl-popup-header">
        <h3 class="ilgl-popup-title">ë¶ˆë²•ì ìš©ì ê²€</h3>
      </div>
      <div id="ilgl-popup-content"></div>
      <div id="ilgl-popup-buttons">
        <button id="ilgl-popup-register-btn" class="ilgl-map-register-btn">
          <i class="fas fa-plus"></i>ë“±ë¡
        </button>
        <button id="ilgl-popup-inquiry-btn" class="ilgl-map-inquiry-btn" style="display: none">
          <i class="fas fa-search"></i>ì¡°íšŒ
        </button>
      </div>
    </div>
```

### 2.3 ì˜ì—­ í•˜ì´ë¼ì´íŠ¸ - OpenLayers Vector Layer

**ì‚¬ìš© í´ë˜ìŠ¤:**

- `ol.layer.Vector` - ë²¡í„° ë ˆì´ì–´
- `ol.source.Vector` - ë²¡í„° ì†ŒìŠ¤
- `ol.style.Style` - ìŠ¤íƒ€ì¼ ì •ì˜
- `ol.style.Stroke` - í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼
- `ol.style.Fill` - ì±„ìš°ê¸° ìŠ¤íƒ€ì¼

**ë¼ì´ë¸ŒëŸ¬ë¦¬:** OpenLayers 3 (v3.20.1)

**ê¸°ëŠ¥:**  
ì„ íƒëœ í•„ì§€ ì˜ì—­ì„ ì§€ë„ ìœ„ì— ì‹œê°ì ìœ¼ë¡œ ê°•ì¡° í‘œì‹œí•˜ëŠ” ë²¡í„° ë ˆì´ì–´ì…ë‹ˆë‹¤. í´ë¦¬ê³¤ geometryë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ì§€ ê²½ê³„ë¥¼ ê·¸ë¦¬ê³ , ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ í‘œì‹œí•©ë‹ˆë‹¤.

**ì½”ë“œ ìœ„ì¹˜:**

```796:809:src/main/webapp/WEB-INF/views/index.jsp
        window.highlightSource = new ol.source.Vector();
        var highlightLayer = new ol.layer.Vector({
          source: window.highlightSource,
          style: function (feature) {
            // featureì˜ hasData ì†ì„±ì— ë”°ë¼ ìŠ¤íƒ€ì¼ ë°˜í™˜
            var hasData = feature.get("hasData");
            if (hasData === true) {
              return dataExistsHighlightStyle;
            } else {
              return defaultHighlightStyle;
            }
          },
          zIndex: 10, // ì´ë¯¸ì§€ ìœ„ì— í‘œì‹œë˜ë„ë¡ ë†’ì€ zIndex
        });
```

**ìŠ¤íƒ€ì¼ ì •ì˜:**

```776:793:src/main/webapp/WEB-INF/views/index.jsp
        // ì„ íƒ ì˜ì—­ í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ (ë™ì  ìŠ¤íƒ€ì¼ í•¨ìˆ˜)
        // ë°ì´í„° ì—†ì„ ë•Œ: íŒŒë€ìƒ‰ + fill (ê¸°ë³¸ ìŠ¤íƒ€ì¼)
        var defaultHighlightStyle = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: "rgba(0, 153, 255, 0.8)",
            width: 3,
          }),
          fill: new ol.style.Fill({ color: "rgba(0, 153, 255, 0.1)" }),
        });

        // ë°ì´í„° ìˆì„ ë•Œ: ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬ë§Œ (fill ì—†ìŒ)
        var dataExistsHighlightStyle = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: "rgba(255, 0, 0, 0.8)",
            width: 3,
          }),
          // fill ì—†ìŒ
        });
```

**ì£¼ìš” êµ¬ì„± ìš”ì†Œ:**

1. **Vector Source (`ol.source.Vector`)**

   - Feature ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ì»¨í…Œì´ë„ˆ
   - `addFeature()`, `clear()`, `removeFeature()` ë“±ì˜ ë©”ì„œë“œ ì œê³µ

2. **Vector Layer (`ol.layer.Vector`)**

   - Vector Sourceì˜ Featureë“¤ì„ ì§€ë„ì— ë Œë”ë§
   - ë™ì  ìŠ¤íƒ€ì¼ í•¨ìˆ˜ë¡œ Featureë³„ë¡œ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ ì ìš© ê°€ëŠ¥

3. **Style (`ol.style.Style`)**

   - Featureì˜ ì‹œê°ì  í‘œí˜„ ì •ì˜
   - Stroke (í…Œë‘ë¦¬), Fill (ì±„ìš°ê¸°), Icon (ì•„ì´ì½˜) ë“± í¬í•¨

4. **ë™ì  ìŠ¤íƒ€ì¼ í•¨ìˆ˜**
   - Featureì˜ `hasData` ì†ì„±ì— ë”°ë¼ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ ë°˜í™˜
   - ë°ì´í„° ì—†ìŒ: íŒŒë€ìƒ‰ í…Œë‘ë¦¬ + ë°˜íˆ¬ëª… íŒŒë€ìƒ‰ ì±„ìš°ê¸°
   - ë°ì´í„° ìˆìŒ: ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬ë§Œ (ì±„ìš°ê¸° ì—†ìŒ)

**ì‚¬ìš© ë°©ë²•:**

```javascript
// Featureë¥¼ Vector Sourceì— ì¶”ê°€í•˜ì—¬ í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ
window.highlightSource.addFeature(selectedFeature);

// í•˜ì´ë¼ì´íŠ¸ ì œê±°
window.highlightSource.clear();

// Featureì— ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ ì†ì„± ì„¤ì •
selectedFeature.set("hasData", true);
selectedFeature.changed(); // ì§€ë„ ë‹¤ì‹œ ë Œë”ë§
```

**GeoJSONì„ OpenLayers Featureë¡œ ë³€í™˜:**

```351:356:src/main/webapp/WEB-INF/views/index.jsp
        var properties = featureData.properties || {};
        var format = new ol.format.GeoJSON();
        selectedFeature = format.readFeature(featureData, {
          dataProjection: "EPSG:3857",
          featureProjection: "EPSG:3857",
        });
```

- `ol.format.GeoJSON`: GeoJSON ë°ì´í„°ë¥¼ OpenLayers Feature ê°ì²´ë¡œ ë³€í™˜
- `dataProjection`: GeoJSON ë°ì´í„°ì˜ ì¢Œí‘œê³„
- `featureProjection`: OpenLayersì—ì„œ ì‚¬ìš©í•  ì¢Œí‘œê³„

### 2.4 ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ

**HTMLì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ:**

```10:11:src/main/webapp/WEB-INF/views/index.jsp
    <link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css" type="text/css" />
    <script src="https://openlayers.org/en/v3.20.1/build/ol.js"></script>
```

**OpenLayers 3 ë„¤ì„ìŠ¤í˜ì´ìŠ¤:**

- ëª¨ë“  OpenLayers í´ë˜ìŠ¤ëŠ” `ol.` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í•˜ìœ„ì— ì¡´ì¬
- ì˜ˆ: `ol.Overlay`, `ol.layer.Vector`, `ol.source.Vector`, `ol.style.Style`

### 2.5 ì •ë¦¬

| ê¸°ëŠ¥                | ë¼ì´ë¸ŒëŸ¬ë¦¬           | í´ë˜ìŠ¤/ì»´í¬ë„ŒíŠ¸                                      | ìš©ë„                                  |
| ------------------- | -------------------- | ---------------------------------------------------- | ------------------------------------- |
| **íŒì—… í‘œì‹œ**       | OpenLayers 3 v3.20.1 | `ol.Overlay`                                         | ì§€ë„ ìœ„ì— HTML íŒì—… í‘œì‹œ              |
| **ì˜ì—­ í•˜ì´ë¼ì´íŠ¸** | OpenLayers 3 v3.20.1 | `ol.layer.Vector` + `ol.source.Vector`               | ì„ íƒëœ í•„ì§€ ê²½ê³„ ì‹œê°í™”               |
| **ìŠ¤íƒ€ì¼ ì •ì˜**     | OpenLayers 3 v3.20.1 | `ol.style.Style`, `ol.style.Stroke`, `ol.style.Fill` | í•˜ì´ë¼ì´íŠ¸ ìƒ‰ìƒ ë° í…Œë‘ë¦¬ ì„¤ì •        |
| **GeoJSON íŒŒì‹±**    | OpenLayers 3 v3.20.1 | `ol.format.GeoJSON`                                  | VWorld API ì‘ë‹µì„ Feature ê°ì²´ë¡œ ë³€í™˜ |

---

## 3. ë°ì´í„° íë¦„ ë‹¨ê³„ë³„ ìƒì„¸ ë¶„ì„

### Step 1: í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ ë° ì¢Œí‘œ ì¶”ì¶œ

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- OpenLayersì˜ `singleclick` ì´ë²¤íŠ¸ ê°ì²´ (`evt`)
- `evt.coordinate` ì†ì„±ì—ì„œ í´ë¦­ ì¢Œí‘œ ì¶”ì¶œ

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

```javascript
var coordinate = evt.coordinate;
// ì˜ˆì‹œ: [126.978, 37.5665]
// í˜•íƒœ: [x, y] ë°°ì—´ (EPSG:3857 ì¢Œí‘œê³„ - Web Mercator)
```

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 2ì—ì„œ WMS GetFeatureInfo URL ìƒì„± ì‹œ ì‚¬ìš©
- Step 5ì—ì„œ íŒì—… ìœ„ì¹˜ ê²°ì • ì‹œ ì‚¬ìš©

**ğŸ’» ì½”ë“œ ìœ„ì¹˜:**

```1002:1002:src/main/webapp/WEB-INF/views/index.jsp
          var coordinate = evt.coordinate;
```

---

### Step 2: WMS GetFeatureInfo ìš”ì²­ URL ìƒì„±

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 1ì—ì„œ ì¶”ì¶œí•œ `coordinate` (í´ë¦­ ì¢Œí‘œ)
- `view.getResolution()` - í˜„ì¬ ì§€ë„ ì¤Œ ë ˆë²¨ì˜ í•´ìƒë„ (í”½ì…€ë‹¹ ë¯¸í„°)
- `LAYER_NAME` ìƒìˆ˜ - `"lp_pa_cbnd_bubun"` (ì§€ì í¸ì§‘ë„ ë¶€ë¶„ ë ˆì´ì–´ëª…)
- `window.cadastralLayer.getSource()` - OpenLayers TileWMS ì†ŒìŠ¤ ê°ì²´

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

```javascript
var viewResolution = view.getResolution(); // ì˜ˆ: 19.109257071294063 (ë¯¸í„°/í”½ì…€)
var source = window.cadastralLayer.getSource(); // TileWMS ì†ŒìŠ¤ ê°ì²´
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**
OpenLayersì˜ `TileWMS` ì†ŒìŠ¤ ê°ì²´ê°€ ë‹¤ìŒ ì •ë³´ë¥¼ ì¡°í•©í•˜ì—¬ WMS GetFeatureInfo í‘œì¤€ URLì„ ìƒì„±:

```javascript
var getFeatureInfoUrl = source.getGetFeatureInfoUrl(
  coordinate, // [126.978, 37.5665] - í´ë¦­ ì¢Œí‘œ
  viewResolution, // 19.109257071294063 - í˜„ì¬ í•´ìƒë„
  "EPSG:3857", // ì¢Œí‘œê³„
  {
    INFO_FORMAT: "application/json",
    QUERY_LAYERS: "lp_pa_cbnd_bubun",
    FEATURE_COUNT: 1,
  }
);
```

**ğŸŒ ìƒì„±ë˜ëŠ” URL ì˜ˆì‹œ:**

```
https://api.vworld.kr/req/wms?
  SERVICE=WMS&
  VERSION=1.3.0&
  REQUEST=GetFeatureInfo&
  LAYERS=lp_pa_cbnd_bubun&
  QUERY_LAYERS=lp_pa_cbnd_bubun&
  INFO_FORMAT=application/json&
  I=128&J=128&WIDTH=256&HEIGHT=256&
  CRS=EPSG:3857&
  X=126.978&Y=37.5665&
  KEY=B13ADD16-4164-347A-A733-CD9022E8FB3B
```

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 3ì—ì„œ Ajax ìš”ì²­ìœ¼ë¡œ ì´ URLì„ í˜¸ì¶œ

**ğŸ’» ì½”ë“œ ìœ„ì¹˜:**

```1007:1017:src/main/webapp/WEB-INF/views/index.jsp
          var getFeatureInfoUrl = source.getGetFeatureInfoUrl(
            coordinate,
            viewResolution,
            "EPSG:3857",
            {
              INFO_FORMAT: "application/json",
              QUERY_LAYERS: LAYER_NAME,
              FEATURE_COUNT: 1,
              info_format: "text/javascript",
            }
          );
```

---

### Step 3: VWorld ì„œë²„ë¡œë¶€í„° GeoJSON ì‘ë‹µ ìˆ˜ì‹ 

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- VWorld API ì„œë²„: `https://api.vworld.kr/req/wms`
- Step 2ì—ì„œ ìƒì„±í•œ `getFeatureInfoUrl`ë¡œ Ajax ìš”ì²­

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**
VWorld ì„œë²„ê°€ JSONP í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” GeoJSON ì‘ë‹µ:

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [126.978, 37.5665],
          [126.979, 37.5665],
          [126.979, 37.5675],
          [126.978, 37.5675],
          [126.978, 37.5665]
        ]]
      },
      "properties": {
        "pnu": "1168010100112300017",
        "addr": "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
        "jibun": "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 1",
        "fullname": "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
        ...
      }
    }
  ]
}
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**
Ajax ìš”ì²­ ì„±ê³µ ì‹œ `parseVWorldFeatureResponse()` í•¨ìˆ˜ë¡œ ì‘ë‹µ íŒŒì‹±:

```1024:1030:src/main/webapp/WEB-INF/views/index.jsp
          $.ajax({
            url: getFeatureInfoUrl,
            dataType: "jsonp",
            jsonpCallback: "parseResponse",
          })
            .done(function (json) {
              var featureData = parseVWorldFeatureResponse(json);
```

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 4ì—ì„œ `showMapPopupFromWMS()` í•¨ìˆ˜ë¡œ ì „ë‹¬

---

### Step 3-1: VWorld ì‘ë‹µ íŒŒì‹± - Feature ê°ì²´ ì¶”ì¶œ

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 3ì—ì„œ ë°›ì€ JSON ì‘ë‹µ ê°ì²´

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**
VWorld APIëŠ” ë‘ ê°€ì§€ ì‘ë‹µ í˜•ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‘˜ ë‹¤ ì²´í¬:

```637:659:src/main/webapp/WEB-INF/views/index.jsp
      function parseVWorldFeatureResponse(json) {
        if (!json) {
          return null;
        }

        // ì‘ë‹µ í˜•ì‹ 1: json.features
        if (json.features && json.features.length > 0) {
          return json.features[0];
        }

        // ì‘ë‹µ í˜•ì‹ 2: json.response.result.featureCollection.features
        if (json.response && json.response.result) {
          var result = json.response.result;
          if (result.featureCollection && result.featureCollection.features) {
            var features = result.featureCollection.features;
            if (features.length > 0) {
              return features[0];
            }
          }
        }

        return null;
      }
```

**ğŸ“¦ ë°˜í™˜ë˜ëŠ” ê°’:**
GeoJSON Feature ê°ì²´ (ì²« ë²ˆì§¸ Feature):

```javascript
{
  type: "Feature",
  geometry: { type: "Polygon", coordinates: [...] },
  properties: {
    pnu: "1168010100112300017",
    addr: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
    ...
  }
}
```

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 4ì—ì„œ `showMapPopupFromWMS()` í•¨ìˆ˜ë¡œ ì „ë‹¬

---

### Step 4: Feature ë°ì´í„° ì²˜ë¦¬ ë° PNU ì¶”ì¶œ

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 3-1ì—ì„œ íŒŒì‹±í•œ `featureData` (GeoJSON Feature ê°ì²´)
- Step 1ì—ì„œ ì¶”ì¶œí•œ `coordinate` (í´ë¦­ ì¢Œí‘œ)

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**
`showMapPopupFromWMS()` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ PNUë¥¼ ì¶”ì¶œí•˜ê³  `processFeatureData()`ë¡œ ì „ë‹¬:

```504:522:src/main/webapp/WEB-INF/views/index.jsp
      window.showMapPopupFromWMS = function (options) {
        var featureData = options.featureData;
        var coordinate = options.coordinate;
        var checkDataExistence = options.checkDataExistence !== false;

        if (!isValidCoordinate(coordinate)) {
          console.error("showMapPopupFromWMS: ìœ íš¨í•˜ì§€ ì•Šì€ ì¢Œí‘œì…ë‹ˆë‹¤.", coordinate);
          return;
        }

        if (!isPopupInitialized()) {
          return;
        }

        // WMSë¡œ ë°›ì•„ì˜¨ featureDataì—ì„œ PNU ì¶”ì¶œ
        var pnu = extractPnuFromFeature(featureData);

        // WMSë¡œ ë°›ì•„ì˜¨ featureData ì§ì ‘ ì²˜ë¦¬
        processFeatureData(featureData, coordinate, pnu, false, checkDataExistence);
      };
```

---

### Step 4-1: PNU(í•„ì§€ë²ˆí˜¸) ì¶”ì¶œ

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- `featureData.properties` ê°ì²´

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

```javascript
// ì˜ˆì‹œ properties ê°ì²´:
{
  pnu: "1168010100112300017",
  addr: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
  jibun: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 1",
  ...
}
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**
ëŒ€ì†Œë¬¸ì ë³€í˜•ê³¼ ë‹¤ë¥¸ í‚¤ëª…ì„ ê³ ë ¤í•˜ì—¬ ì—¬ëŸ¬ í‚¤ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í™•ì¸:

```608:614:src/main/webapp/WEB-INF/views/index.jsp
      function extractPnuFromFeature(featureData) {
        if (!featureData || !featureData.properties) {
          return null;
        }
        var props = featureData.properties;
        return props.pnu || props.PNU || props.pnu_code || null;
      }
```

**ğŸ“¦ ë°˜í™˜ë˜ëŠ” ê°’:**

- ì„±ê³µ: í•„ì§€ë²ˆí˜¸ ë¬¸ìì—´ (ì˜ˆ: `"1168010100112300017"`)
- ì‹¤íŒ¨: `null`

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 5ì—ì„œ Region ë°ì´í„° êµ¬ì„± ì‹œ ì‚¬ìš©
- Step 7ì—ì„œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ì‹œ ì‚¬ìš©

---

### Step 5: Propertiesì—ì„œ ì£¼ì†Œ ì •ë³´ ì¶”ì¶œ ë° Region ê°ì²´ êµ¬ì„±

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- `featureData.properties` - VWorld APIì—ì„œ ë°›ì€ ì†ì„± ì •ë³´
- `featureData.geometry` - GeoJSON geometry (í´ë¦¬ê³¤ ì •ë³´)
- `coordinate` - Step 1ì—ì„œ ì¶”ì¶œí•œ í´ë¦­ ì¢Œí‘œ
- `pnu` - Step 4-1ì—ì„œ ì¶”ì¶œí•œ í•„ì§€ë²ˆí˜¸

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

```javascript
// properties ê°ì²´ ì˜ˆì‹œ:
{
  pnu: "1168010100112300017",
  addr: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
  jibun: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 1",
  fullname: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
  ...
}
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**

#### 5-1. ì£¼ì†Œ ì •ë³´ ì¶”ì¶œ

`buildRegionData()` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `getFirstAvailable()` í•¨ìˆ˜ë¡œ ì—¬ëŸ¬ ê°€ëŠ¥í•œ í‚¤ ì¤‘ ì²« ë²ˆì§¸ ìœ íš¨ê°’ ì¶”ì¶œ:

```175:187:src/main/webapp/WEB-INF/views/index.jsp
        region.address = getFirstAvailable(props, [
          "addr",
          "address",
          "full_addr",
          "fullname",
        ]);
        region.jibunAddress = getFirstAvailable(props, [
          "jibun",
          "jibun_address",
          "land_address",
        ]);
        // PNU ê°’ ì¶”ì¶œ
        region.pnu = getFirstAvailable(props, ["pnu", "PNU", "pnu_code"]);
```

`getFirstAvailable()` í•¨ìˆ˜ëŠ” ë‹¤ìŒ ìˆœì„œë¡œ ê°’ì„ ì°¾ìŒ:

```95:109:src/main/webapp/WEB-INF/views/index.jsp
      function getFirstAvailable(props, keys) {
        if (!props) {
          return null;
        }
        for (var i = 0; i < keys.length; i++) {
          var value = props[keys[i]];
          if (value !== undefined && value !== null) {
            var trimmed = String(value).trim();
            if (trimmed.length > 0) {
              return trimmed;
            }
          }
        }
        return null;
      }
```

**ê²°ê³¼ ì˜ˆì‹œ:**

- `region.address = "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110"` (props.addrì—ì„œ ì¶”ì¶œ)
- `region.jibunAddress = "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 1"` (props.jibunì—ì„œ ì¶”ì¶œ)
- `region.pnu = "1168010100112300017"` (props.pnuì—ì„œ ì¶”ì¶œ)

#### 5-2. ì•ˆì „í•œ ì¢Œí‘œ ê³„ì‚° (í´ë¦¬ê³¤ ë‚´ë¶€ì )

ê²½ê³„ì„  ê·¼ì²˜ í´ë¦­ ì‹œ ì¸ì ‘ í•„ì§€ê°€ ì„ íƒë˜ëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ í´ë¦¬ê³¤ ë‚´ë¶€ì ì„ ê³„ì‚°:

```193:220:src/main/webapp/WEB-INF/views/index.jsp
        var safeCoordinate = coordinate;
        if (!useOriginalCoordinate && feature) {
          try {
            var geometry = feature.getGeometry();
            if (geometry) {
              // í´ë¦¬ê³¤ì˜ ë‚´ë¶€ì  ê³„ì‚°
              var interiorPoint = getPolygonInteriorPoint(geometry);
              if (
                interiorPoint &&
                Array.isArray(interiorPoint) &&
                interiorPoint.length >= 2
              ) {
                safeCoordinate = interiorPoint;
              } else {
                // ë‚´ë¶€ì  ê³„ì‚° ì‹¤íŒ¨ ì‹œ extent ì¤‘ì‹¬ì  ì‚¬ìš©
                var extent = geometry.getExtent();
                if (extent && extent.length >= 4) {
                  var center = ol.extent.getCenter(extent);
                  if (center && Array.isArray(center) && center.length >= 2) {
                    safeCoordinate = center;
                  }
                }
              }
            }
          } catch (e) {
            // ì‹¤íŒ¨ ì‹œ ì›ë³¸ coordinate ì‚¬ìš©
          }
        }
```

**ì²˜ë¦¬ ìˆœì„œ:**

1. `getPolygonInteriorPoint(geometry)` - í´ë¦¬ê³¤ ë‚´ë¶€ì  ê³„ì‚° ì‹œë„
2. ì‹¤íŒ¨ ì‹œ `ol.extent.getCenter(extent)` - í´ë¦¬ê³¤ ê²½ê³„ ìƒì ì¤‘ì‹¬ì  ì‚¬ìš©
3. ìµœì¢… ì‹¤íŒ¨ ì‹œ ì›ë³¸ í´ë¦­ ì¢Œí‘œ ì‚¬ìš©

#### 5-3. ìµœì¢… Region ê°ì²´ êµ¬ì„±

```222:232:src/main/webapp/WEB-INF/views/index.jsp
        // ì¢Œí‘œ ì €ì¥
        if (
          safeCoordinate &&
          Array.isArray(safeCoordinate) &&
          safeCoordinate.length >= 2
        ) {
          region.coordinateX = safeCoordinate[0];
          region.coordinateY = safeCoordinate[1];
        }

        return region;
```

**ğŸ“¦ ìµœì¢… ë°˜í™˜ë˜ëŠ” Region ê°ì²´ ì˜ˆì‹œ:**

```javascript
{
  address: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110",
  jibunAddress: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 1",
  pnu: "1168010100112300017",
  coordinateX: 126.978,
  coordinateY: 37.5665
}
```

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 6ì—ì„œ íŒì—… ë‚´ìš© ìƒì„± (`buildPopupContent()`)
- Step 9ì—ì„œ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸° (`IllegalRegisterModal.open(selectedRegionData)`)
- Step 8ì—ì„œ í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ

**ğŸ’» ì½”ë“œ ìœ„ì¹˜:**

```168:233:src/main/webapp/WEB-INF/views/index.jsp
      function buildRegionData(
        props,
        feature,
        coordinate,
        useOriginalCoordinate
      ) {
        var region = {};
        region.address = getFirstAvailable(props, [
          "addr",
          "address",
          "full_addr",
          "fullname",
        ]);
        region.jibunAddress = getFirstAvailable(props, [
          "jibun",
          "jibun_address",
          "land_address",
        ]);
        // PNU ê°’ ì¶”ì¶œ
        region.pnu = getFirstAvailable(props, ["pnu", "PNU", "pnu_code"]);

        // ì¢Œí‘œ ì •ë³´: featureì˜ geometryì—ì„œ í´ë¦¬ê³¤ ë‚´ë¶€ì  ê³„ì‚°í•˜ì—¬ ì‚¬ìš©
        // ê²½ê³„ì„  ê·¼ì²˜ í´ë¦­ ì‹œ ì¸ì ‘ ìš©ì§€ê°€ ì„ íƒë˜ëŠ” ë¬¸ì œ ë°©ì§€
        // ì˜ì—­ ë“±ë¡ ì‹œ í´ë¦¬ê³¤ ë‚´ë¶€ ì¢Œí‘œë¥¼ ì €ì¥í•˜ê¸° ìœ„í•¨
        // ë‹¨, useOriginalCoordinateê°€ trueì¸ ê²½ìš°(íŒ¨ë„ í˜¸ì¶œ) ì›ë³¸ ì¢Œí‘œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        var safeCoordinate = coordinate;
        if (!useOriginalCoordinate && feature) {
          try {
            var geometry = feature.getGeometry();
            if (geometry) {
              // í´ë¦¬ê³¤ì˜ ë‚´ë¶€ì  ê³„ì‚°
              var interiorPoint = getPolygonInteriorPoint(geometry);
              if (
                interiorPoint &&
                Array.isArray(interiorPoint) &&
                interiorPoint.length >= 2
              ) {
                safeCoordinate = interiorPoint;
              } else {
                // ë‚´ë¶€ì  ê³„ì‚° ì‹¤íŒ¨ ì‹œ extent ì¤‘ì‹¬ì  ì‚¬ìš©
                var extent = geometry.getExtent();
                if (extent && extent.length >= 4) {
                  var center = ol.extent.getCenter(extent);
                  if (center && Array.isArray(center) && center.length >= 2) {
                    safeCoordinate = center;
                  }
                }
              }
            }
          } catch (e) {
            // ì‹¤íŒ¨ ì‹œ ì›ë³¸ coordinate ì‚¬ìš©
          }
        }

        // ì¢Œí‘œ ì €ì¥
        if (
          safeCoordinate &&
          Array.isArray(safeCoordinate) &&
          safeCoordinate.length >= 2
        ) {
          region.coordinateX = safeCoordinate[0];
          region.coordinateY = safeCoordinate[1];
        }

        return region;
      }
```

---

### Step 6: íŒì—… HTML ë‚´ìš© ìƒì„±

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 5ì—ì„œ êµ¬ì„±í•œ `selectedRegionData` ê°ì²´
- íŠ¹íˆ `selectedRegionData.address` ì†ì„±

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

```javascript
// selectedRegionData.address
"ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110";
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**

```625:630:src/main/webapp/WEB-INF/views/index.jsp
      function buildPopupContent(region) {
        if (!region) {
          return "<span>ì„ íƒëœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>";
        }
        return window.escapeHtml(region.address || "-");
      }
```

- HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ (`escapeHtml()` í•¨ìˆ˜)
- ê°’ì´ ì—†ìœ¼ë©´ `"-"` í‘œì‹œ

**ğŸ“¦ ë°˜í™˜ë˜ëŠ” ê°’:**
HTML ë¬¸ìì—´: `"ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110"`

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**
íŒì—… DOM ìš”ì†Œì˜ innerHTMLì— ì‚½ì…:

```379:379:src/main/webapp/WEB-INF/views/index.jsp
        window.popupContent.innerHTML = buildPopupContent(selectedRegionData);
```

---

### Step 7: PNUë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 4-1ì—ì„œ ì¶”ì¶œí•œ `pnu` (í•„ì§€ë²ˆí˜¸)
- ìºì‹œ: `window.dataExistenceCache[pnu]` (ì´ì „ ì¡°íšŒ ê²°ê³¼)

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

```javascript
var pnu = "1168010100112300017";
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**

#### 7-1. ìºì‹œ í™•ì¸

ë¨¼ì € ìºì‹œì— ì €ì¥ëœ ê²°ê³¼ê°€ ìˆëŠ”ì§€ í™•ì¸:

```247:251:src/main/webapp/WEB-INF/views/index.jsp
        // ìºì‹œì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ë°©ì§€)
        if (window.dataExistenceCache.hasOwnProperty(pnu)) {
          var hasData = window.dataExistenceCache[pnu];
          updateUIWithDataExistence(hasData, feature);
          return;
        }
```

ìºì‹œì— ìˆìœ¼ë©´ â†’ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (API í˜¸ì¶œ ìƒëµ)

#### 7-2. ì„œë²„ API í˜¸ì¶œ (ìºì‹œì— ì—†ëŠ” ê²½ìš°)

Spring Boot ë°±ì—”ë“œ APIë¡œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸:

```254:280:src/main/webapp/WEB-INF/views/index.jsp
        // ìºì‹œì— ì—†ìœ¼ë©´ API í˜¸ì¶œ
        $.ajax({
          url: "/regions/dates",
          method: "GET",
          data: {
            lndsUnqNo: pnu,
            type: "detail",
          },
          dataType: "json",
        })
          .done(function (response) {
            var hasData = false;
            if (response.success && response.data && response.data.dates) {
              var dates = response.data.dates;
              hasData = Array.isArray(dates) && dates.length > 0;
            }

            // ìºì‹œì— ì €ì¥
            window.dataExistenceCache[pnu] = hasData;

            // UI ì—…ë°ì´íŠ¸
            updateUIWithDataExistence(hasData, feature);
          })
          .fail(function (xhr, status, error) {
            console.warn("ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨:", status, error);
            // ì‹¤íŒ¨ ì‹œì—ëŠ” ë°ì´í„° ì—†ìŒìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìºì‹œì— ì €ì¥í•˜ì§€ ì•ŠìŒ
            updateUIWithDataExistence(false, feature);
          });
```

**API ìš”ì²­ ì •ë³´:**

- URL: `/regions/dates` (ìƒëŒ€ ê²½ë¡œ â†’ í˜„ì¬ ì„œë²„ì˜ Spring Boot ë°±ì—”ë“œ)
- Method: `GET`
- íŒŒë¼ë¯¸í„°:
  - `lndsUnqNo`: í•„ì§€ë²ˆí˜¸ (ì˜ˆ: `"1168010100112300017"`)
  - `type`: `"detail"`

**ì„œë²„ ì‘ë‹µ ì˜ˆì‹œ:**

```json
{
  "success": true,
  "data": {
    "dates": ["2024-01-15", "2024-02-20"]
  }
}
```

**ì²˜ë¦¬ ë¡œì§:**

- `dates` ë°°ì—´ì´ ìˆê³  ê¸¸ì´ê°€ 0ë³´ë‹¤ í¬ë©´ â†’ `hasData = true`
- ì—†ìœ¼ë©´ â†’ `hasData = false`
- ìºì‹œì— ì €ì¥: `window.dataExistenceCache["1168010100112300017"] = true`

**ğŸ“¦ ë°˜í™˜ë˜ëŠ” ê°’:**

- `hasData`: `true` ë˜ëŠ” `false` (boolean)

**ğŸ”„ ë‹¤ìŒì— ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€:**

- Step 7-1ì—ì„œ `updateUIWithDataExistence()` í•¨ìˆ˜ë¡œ UI ì—…ë°ì´íŠ¸

---

### Step 7-1: UI ì—…ë°ì´íŠ¸ (ë²„íŠ¼ í‘œì‹œ ë° ìŠ¤íƒ€ì¼ ì ìš©)

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 7ì—ì„œ í™•ì¸í•œ `hasData` (boolean)
- `feature` - OpenLayers Feature ê°ì²´

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**

```283:302:src/main/webapp/WEB-INF/views/index.jsp
      function updateUIWithDataExistence(hasData, feature) {
        if (hasData) {
          // ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° - ë“±ë¡ ë²„íŠ¼ê³¼ ì¡°íšŒ ë²„íŠ¼ ëª¨ë‘ í‘œì‹œ
          showBothButtons();
          // featureì— ë°ì´í„° ìˆìŒ í‘œì‹œ (ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬)
          if (feature) {
            feature.set("hasData", true);
            feature.changed(); // ì§€ë„ ë‹¤ì‹œ ë Œë”ë§
          }
        } else {
          // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° - ë“±ë¡ ë²„íŠ¼ë§Œ í‘œì‹œ
          resetPopupButtons();
          // featureì— ë°ì´í„° ì—†ìŒ í‘œì‹œ (íŒŒë€ìƒ‰ ê¸°ë³¸ ìŠ¤íƒ€ì¼)
          if (feature) {
            feature.set("hasData", false);
            feature.changed(); // ì§€ë„ ë‹¤ì‹œ ë Œë”ë§
          }
        }
      }
```

**ë²„íŠ¼ í‘œì‹œ ë¡œì§:**

- `hasData === true`: `showBothButtons()` â†’ ë“±ë¡ ë²„íŠ¼ + ì¡°íšŒ ë²„íŠ¼ í‘œì‹œ
- `hasData === false`: `resetPopupButtons()` â†’ ë“±ë¡ ë²„íŠ¼ë§Œ í‘œì‹œ

**í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ ì ìš©:**

- `feature.set("hasData", true/false)`: Feature ê°ì²´ì— ì†ì„± ì €ì¥
- `feature.changed()`: ì§€ë„ ë‹¤ì‹œ ë Œë”ë§ íŠ¸ë¦¬ê±°
- í•˜ì´ë¼ì´íŠ¸ ë ˆì´ì–´ì˜ ìŠ¤íƒ€ì¼ í•¨ìˆ˜ê°€ `feature.get("hasData")` ê°’ì„ í™•ì¸í•˜ì—¬ ìƒ‰ìƒ ê²°ì •:
  - `true` â†’ ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬ (`dataExistsHighlightStyle`)
  - `false` â†’ íŒŒë€ìƒ‰ í…Œë‘ë¦¬ + ë°˜íˆ¬ëª… ì±„ìš°ê¸° (`defaultHighlightStyle`)

---

### Step 8: í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ (Vector Layerì— Feature ì¶”ê°€)

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 5ì—ì„œ GeoJSONì„ OpenLayers Featureë¡œ ë³€í™˜í•œ `selectedFeature` ê°ì²´

**ğŸ“¦ ì–´ë–¤ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**
OpenLayers Feature ê°ì²´:

```javascript
{
  geometry: ol.geom.Polygon(...), // í´ë¦¬ê³¤ geometry
  properties: {
    pnu: "1168010100112300017",
    ...
  }
}
```

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**

**ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° í´ë˜ìŠ¤:**

- **ë¼ì´ë¸ŒëŸ¬ë¦¬:** OpenLayers 3 (v3.20.1)
- **ì‚¬ìš© í´ë˜ìŠ¤:**
  - `ol.source.Vector` - Vector Source ê°ì²´
  - `ol.layer.Vector` - Vector Layer ê°ì²´ (ì´ë¯¸ ì´ˆê¸°í™”ë¨)

```375:376:src/main/webapp/WEB-INF/views/index.jsp
        // ì˜ì—­ í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ
        window.highlightSource.addFeature(selectedFeature);
```

**ì‘ë™ ì›ë¦¬:**

1. `window.highlightSource` (`ol.source.Vector`)ì— Feature ì¶”ê°€
2. `highlightLayer` (`ol.layer.Vector`)ê°€ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ì§€ë„ì— ë Œë”ë§
3. ë ˆì´ì–´ì˜ ë™ì  ìŠ¤íƒ€ì¼ í•¨ìˆ˜ê°€ `feature.get("hasData")` ê°’ì„ í™•ì¸í•˜ì—¬ ìƒ‰ìƒ ê²°ì •:
   - `hasData === true`: `dataExistsHighlightStyle` â†’ ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬ë§Œ
   - `hasData === false`: `defaultHighlightStyle` â†’ íŒŒë€ìƒ‰ í…Œë‘ë¦¬ + ë°˜íˆ¬ëª… íŒŒë€ìƒ‰ ì±„ìš°ê¸°

**ìŠ¤íƒ€ì¼ ì ìš© ë¡œì§:**

```797:807:src/main/webapp/WEB-INF/views/index.jsp
        var highlightLayer = new ol.layer.Vector({
          source: window.highlightSource,
          style: function (feature) {
            // featureì˜ hasData ì†ì„±ì— ë”°ë¼ ìŠ¤íƒ€ì¼ ë°˜í™˜
            var hasData = feature.get("hasData");
            if (hasData === true) {
              return dataExistsHighlightStyle;
            } else {
              return defaultHighlightStyle;
            }
          },
          zIndex: 10, // ì´ë¯¸ì§€ ìœ„ì— í‘œì‹œë˜ë„ë¡ ë†’ì€ zIndex
        });
```

**ì‹œê°ì  ê²°ê³¼:**

- ì„ íƒëœ í•„ì§€ê°€ íŒŒë€ìƒ‰ ë˜ëŠ” ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬ë¡œ ì§€ë„ì— í‘œì‹œë¨
- `zIndex: 10` ì„¤ì •ìœ¼ë¡œ ë‹¤ë¥¸ ë ˆì´ì–´ ìœ„ì— í‘œì‹œ

---

### Step 9: íŒì—… ì˜¤ë²„ë ˆì´ ìœ„ì¹˜ ì„¤ì • ë° í‘œì‹œ

**ğŸ“ ì–´ë””ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ê°€:**

- Step 1ì—ì„œ ì¶”ì¶œí•œ `coordinate` (í´ë¦­ ì¢Œí‘œ)
- ë˜ëŠ” Step 5ì—ì„œ ê³„ì‚°í•œ í´ë¦¬ê³¤ ë‚´ë¶€ì  ì¢Œí‘œ

**ğŸ”„ ì²˜ë¦¬ ê³¼ì •:**

**ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° í´ë˜ìŠ¤:**

- **ë¼ì´ë¸ŒëŸ¬ë¦¬:** OpenLayers 3 (v3.20.1)
- **ì‚¬ìš© í´ë˜ìŠ¤:** `ol.Overlay` - ì˜¤ë²„ë ˆì´ ê°ì²´

```392:394:src/main/webapp/WEB-INF/views/index.jsp
        // íŒì—… ìœ„ì¹˜ ê²°ì • ë° í‘œì‹œ
        var popupCoordinate = getPopupCoordinate(coordinate, useOriginalCoordinate);
        window.popupOverlay.setPosition(popupCoordinate);
```

**ì¢Œí‘œ ê²°ì • ë¡œì§:**

```439:449:src/main/webapp/WEB-INF/views/index.jsp
      function getPopupCoordinate(coordinate, useOriginalCoordinate) {
        if (
          useOriginalCoordinate &&
          selectedRegionData &&
          selectedRegionData.coordinateX &&
          selectedRegionData.coordinateY
        ) {
          return [selectedRegionData.coordinateX, selectedRegionData.coordinateY];
        }
        return coordinate;
      }
```

- íŒ¨ë„ì—ì„œ í˜¸ì¶œ ì‹œ (`useOriginalCoordinate === true`): í´ë¦¬ê³¤ ë‚´ë¶€ì  ì¢Œí‘œ ì‚¬ìš©
- ì§€ë„ í´ë¦­ ì‹œ (`useOriginalCoordinate === false`): í´ë¦­ ì¢Œí‘œ ê·¸ëŒ€ë¡œ ì‚¬ìš©

**íŒì—… ì˜¤ë²„ë ˆì´ ì´ˆê¸°í™” (ì°¸ê³ ):**

```965:970:src/main/webapp/WEB-INF/views/index.jsp
        window.popupOverlay = new ol.Overlay({
          element: container,
          autoPan: true,
          autoPanAnimation: { duration: 250 },
        });
        window.map.addOverlay(window.popupOverlay);
```

**Overlay ì†ì„±:**

- `element`: HTML DOM ìš”ì†Œ (`#ilgl-popup` ì»¨í…Œì´ë„ˆ)
- `autoPan: true`: íŒì—…ì´ í™”ë©´ ë°–ì— ìˆì„ ë•Œ ì§€ë„ê°€ ìë™ìœ¼ë¡œ ì´ë™
- `autoPanAnimation: { duration: 250 }`: ìë™ íŒ¬ ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ (250ms)

**íŒì—… í‘œì‹œ ë©”ì„œë“œ:**

- `window.popupOverlay.setPosition([x, y])`: ì¢Œí‘œ ë°°ì—´ (EPSG:3857) ì„¤ì • ì‹œ íŒì—… í‘œì‹œ
- `window.popupOverlay.setPosition(undefined)`: íŒì—… ìˆ¨ê¸°ê¸°

**ì‹œê°ì  ê²°ê³¼:**

- ì§€ë„ ìœ„ì— íŒì—… ì°½ì´ í‘œì‹œë¨
- íŒì—… ë‚´ìš©: ì£¼ì†Œ ì •ë³´ (`"ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110"`)
- íŒì—… ë²„íŠ¼: ë“±ë¡ ë²„íŠ¼ (+ ì¡°íšŒ ë²„íŠ¼, ë°ì´í„° ìˆëŠ” ê²½ìš°)
- ìë™ íŒ¬: íŒì—…ì´ í™”ë©´ ë°–ì— ìˆìœ¼ë©´ ì§€ë„ê°€ ë¶€ë“œëŸ½ê²Œ ì´ë™ (250ms ì• ë‹ˆë©”ì´ì…˜)

---

## 4. ì£¼ì†Œ ì¡°íšŒ ì„œë¹„ìŠ¤

### 3.1 ì§€ì  ì •ë³´ ì¡°íšŒ ì„œë²„

**ì„œë²„ ì •ë³´:**

- ì„œë²„ ì£¼ì†Œ: `https://api.vworld.kr/req/wms`
- API í‚¤: `B13ADD16-4164-347A-A733-CD9022E8FB3B`
- ë ˆì´ì–´ëª…: `lp_pa_cbnd_bubun` (ì§€ì í¸ì§‘ë„ ë¶€ë¶„)

**ì„¤ëª…:**
VWorldëŠ” êµ­í† êµí†µë¶€ ê³µê°„ì •ë³´ í”Œë«í¼ìœ¼ë¡œ, ì •ë¶€ê°€ ì œê³µí•˜ëŠ” ê³µê°„ ë°ì´í„°ë¥¼ í‘œì¤€ WMS/WFS ì„œë¹„ìŠ¤ë¡œ ì œê³µí•©ë‹ˆë‹¤.

**ì‚¬ìš© ìœ„ì¹˜:**

```716:729:src/main/webapp/WEB-INF/views/index.jsp
        // ì§€ì í¸ì§‘ë„ ë ˆì´ì–´ (ì „ì—­ ë³€ìˆ˜ë¡œ ë“±ë¡)
        window.cadastralLayer = new ol.layer.Tile({
          source: new ol.source.TileWMS({
            url: "https://api.vworld.kr/req/wms",
            params: {
              LAYERS: LAYER_NAME,
              STYLES: LAYER_NAME,
              CRS: "EPSG:3857",
              FORMAT: "image/png",
              TRANSPARENT: true,
              KEY: VWORLD_API_KEY,
            },
          }),
          zIndex: 5,
        });
```

### 3.2 ì£¼ì†Œ ê²€ìƒ‰ ì„œë²„

**ì„œë²„ ì •ë³´:**

- ì„œë²„ ì£¼ì†Œ: `https://api.vworld.kr/req/search`
- API í‚¤: `F0529714-44EF-31EC-BCD3-9BB544307DDB`
- ê²€ìƒ‰ ìœ í˜•: `type=address`, `category=parcel` (í•„ì§€ ì£¼ì†Œ)

**ì‚¬ìš© ìœ„ì¹˜:**

```269:329:src/main/webapp/WEB-INF/views/addressSearchModal.jsp
// VWorld API ì„¤ì •
var VWORLD_API_URL = "https://api.vworld.kr/req/search";
var VWORLD_API_KEY = "F0529714-44EF-31EC-BCD3-9BB544307DDB";
var RESULT_SIZE = 10;

// ì£¼ì†Œ ê²€ìƒ‰ í•¨ìˆ˜
function searchAddress(page) {
    ...
    // VWorld API íŒŒë¼ë¯¸í„° ì„¤ì •
    var apiUrl = VWORLD_API_URL +
        "?service=search" +
        "&request=search" +
        "&version=2.0" +
        "&crs=EPSG:900913" +
        "&size=" + RESULT_SIZE +
        "&page=" + page +
        "&query=" + encodeURIComponent(query) +
        "&type=address" +
        "&category=parcel" +
        "&format=json" +
        "&errorformat=json" +
        "&key=" + VWORLD_API_KEY;
    ...
}
```

---

## 5. ì „ì²´ ë°ì´í„° íë¦„ ìš”ì•½

```
[ì‚¬ìš©ì í´ë¦­]
    â†“
[Step 1] ì¢Œí‘œ ì¶”ì¶œ: evt.coordinate â†’ [126.978, 37.5665]
    â†“
[Step 2] WMS URL ìƒì„±:
    - coordinate + viewResolution + LAYER_NAME
    â†’ "https://api.vworld.kr/req/wms?REQUEST=GetFeatureInfo&..."
    â†“
[Step 3] Ajax ìš”ì²­ â†’ VWorld ì„œë²„
    â†“
[Step 3-1] ì‘ë‹µ íŒŒì‹±:
    - JSON ì‘ë‹µ â†’ GeoJSON Feature ê°ì²´ ì¶”ì¶œ
    â†’ {type: "Feature", properties: {pnu: "...", addr: "..."}, geometry: {...}}
    â†“
[Step 4] Feature ì²˜ë¦¬:
    - featureData â†’ showMapPopupFromWMS()
    â†“
[Step 4-1] PNU ì¶”ì¶œ:
    - featureData.properties â†’ "1168010100112300017"
    â†“
[Step 5] Region ê°ì²´ êµ¬ì„±:
    - properties.addr â†’ region.address = "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110"
    - properties.jibun â†’ region.jibunAddress = "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 1"
    - properties.pnu â†’ region.pnu = "1168010100112300017"
    - geometry â†’ í´ë¦¬ê³¤ ë‚´ë¶€ì  ê³„ì‚° â†’ region.coordinateX, coordinateY
    â†“
[Step 6] íŒì—… ë‚´ìš© ìƒì„±:
    - region.address â†’ HTML ë¬¸ìì—´
    â†’ "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110"
    â†“
[Step 7] ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸:
    - pnu â†’ "/regions/dates?lndsUnqNo=1168010100112300017"
    - ì„œë²„ ì‘ë‹µ â†’ hasData = true/false
    â†“
[Step 7-1] UI ì—…ë°ì´íŠ¸:
    - hasData â†’ ë²„íŠ¼ í‘œì‹œ (ë“±ë¡ + ì¡°íšŒ / ë“±ë¡ë§Œ)
    - feature.set("hasData", true/false) â†’ ìŠ¤íƒ€ì¼ ê²°ì •
    â†“
[Step 8] í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ:
    - selectedFeature â†’ highlightSource.addFeature()
    â†’ ì§€ë„ì— íŒŒë€ìƒ‰/ë¶‰ì€ìƒ‰ í…Œë‘ë¦¬ í‘œì‹œ
    â†“
[Step 9] íŒì—… í‘œì‹œ:
    - coordinate â†’ popupOverlay.setPosition()
    â†’ ì§€ë„ ìœ„ì— íŒì—… ì°½ í‘œì‹œ
```

---

## 6. í•µì‹¬ í¬ì¸íŠ¸ ì •ë¦¬

### 5.1 ë°ì´í„° ì¶œì²˜

1. **í´ë¦­ ì¢Œí‘œ**: OpenLayers ì´ë²¤íŠ¸ (`evt.coordinate`)
2. **ì§€ì  ì •ë³´**: VWorld WMS API (`https://api.vworld.kr/req/wms`)
3. **ì£¼ì†Œ ê²€ìƒ‰**: VWorld Search API (`https://api.vworld.kr/req/search`)
4. **ë°ì´í„° ì¡´ì¬ ì—¬ë¶€**: ë‚´ë¶€ Spring Boot API (`/regions/dates`)

### 5.2 ì£¼ìš” ë³€í™˜ ê³¼ì •

1. **ì¢Œí‘œ**: í´ë¦­ ì¢Œí‘œ â†’ í´ë¦¬ê³¤ ë‚´ë¶€ì  ê³„ì‚° (ì•ˆì „í•œ ì¢Œí‘œ)
2. **ë°ì´í„°**: JSON ì‘ë‹µ â†’ GeoJSON Feature â†’ OpenLayers Feature
3. **ì†ì„±**: Properties ê°ì²´ â†’ Region ê°ì²´ (ì£¼ì†Œ, PNU, ì¢Œí‘œ ì¶”ì¶œ)
4. **UI**: ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ â†’ ë²„íŠ¼ í‘œì‹œ + ìŠ¤íƒ€ì¼ ì ìš©

### 5.3 ìºì‹± ì „ëµ

- **PNUë³„ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€**: `window.dataExistenceCache[pnu]`
- **ëª©ì **: ì¤‘ë³µ API í˜¸ì¶œ ë°©ì§€, UI ê¹œë¹¡ì„ ë°©ì§€
- **ìƒëª…ì£¼ê¸°**: í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”, ë°ì´í„° ë“±ë¡/ìˆ˜ì • ì‹œ ì‚­ì œ

---

**ì‘ì„±ì¼**: 2024ë…„
**ë²„ì „**: 1.0

# 토지(Toji) 프로젝트 기능 분석 문서

## 📋 프로젝트 개요

**프로젝트명**: toji (토지)  
**프로젝트 목적**: 도로 관리 기관에서 **불법점용 용지(토지)**를 체계적으로 관리하기 위한 웹 기반 지리정보시스템(GIS)

**핵심 가치**: 
- 지도상에서 직접 토지를 선택하여 불법점용 정보를 등록/관리
- 현장 사진을 날짜별로 관리하고 시각적으로 비교
- 조치 이력을 체계적으로 기록하여 추적 가능

**기술 스택**: Spring Boot 3.5.5, Java 17, Oracle Database, MyBatis, JSP, OpenLayers, VWorld API

---

## 🎯 주요 기능 상세

### 1. 지도 기반 토지 선택 및 조회
**기능 설명**: VWorld 연속지적도를 활용하여 지도상에서 토지를 클릭하면 해당 위치의 지적 정보를 자동으로 조회하고, 불법점용 데이터 존재 여부를 시각적으로 표시합니다.

**사용 기술**:
- VWorld API (WMS/WFS)로 지적도 레이어 표시
- OpenLayers로 지도 렌더링 및 상호작용
- PNU(필지번호) 기반 토지 식별

**사용자 경험**:
- 지도 클릭 → 해당 위치의 지적 정보 자동 조회
- 데이터 존재 여부 시각화:
  - **파란색 테두리 + fill**: 데이터 없음 (신규 등록 가능)
  - **붉은색 테두리**: 데이터 있음 (조회/수정 가능)
- 팝업에서 "등록" 또는 "조회" 버튼 선택

### 2. 불법점용 정보 등록
**기능 설명**: 지도에서 선택한 토지에 대한 불법점용 정보를 체계적으로 등록합니다. 기본정보, 조치이력, 현장 사진을 한 번에 등록할 수 있습니다.

**등록 항목**:
1. **기본 정보**:
   - 관리 주체: 본부명, 지사명
   - 위치 정보: 노선코드, 주행방향, 이정, 주소, GPS 좌표, 토지고유번호
   - 발생 정보: 발생일자, 담당자 사원번호
   - 행위자 정보: 행위자명/주소, 관련자명/주소
   - 점유 정보: 불법점유율(%), 불법점유면적(㎡)
   - 상태 정보: 조치상태(조치중/조치완료), 시설물분류(일반/교량)

2. **조치 이력**: 
   - 여러 건의 조치 이력을 등록 가능 (예: 구두주의, 경고 등)
   - 각 이력마다 조치일시와 조치내용 입력

3. **현장 사진**:
   - 날짜별로 사진 등록 (촬영일자 필수)
   - 여러 장의 사진을 날짜와 함께 등록 가능
   - 클라이언트에서 Base64로 변환하여 전송
   - 서버에서 파일로 저장 후 지도상에 오버레이로 표시

**특징**:
- 지도에서 선택한 위치 정보(주소, 좌표, PNU) 자동 입력
- 이미지 미리보기 제공
- 필수 항목 유효성 검사

### 3. 불법점용 정보 조회
**기능 설명**: 등록된 불법점용 정보를 다양한 방식으로 조회할 수 있습니다.

**조회 방식**:
1. **사이드 패널 목록 조회**:
   - 페이징 처리된 리스트 (기본 5개/페이지)
   - 주소, 순번 표시
   - 클릭 시 지도 이동 및 상세 조회

2. **상세 정보 조회**:
   - 등록일 목록에서 날짜 선택 → 해당 날짜의 상세정보 표시
   - 기본정보, 조치이력, 사진 개수 표시
   - 좌측 사이드바에 등록일 목록, 우측에 상세정보 표시

3. **사진 비교 기능**:
   - 최대 3개의 사진을 동시에 비교
   - 날짜별로 사진 선택하여 지도상에 오버레이 표시
   - 투명도 조절 가능
   - 도로맵/항공사진 전환 가능

**특징**:
- 같은 토지에 여러 날짜의 데이터가 있어도 날짜별로 구분하여 조회
- 사진 개수 자동 표시 (같은 날짜에 여러 장인 경우)

### 4. 불법점용 정보 수정
**기능 설명**: 등록된 불법점용 정보를 수정할 수 있습니다. 조회 모달에서 "수정" 버튼을 클릭하면 수정 모달이 열립니다.

**수정 가능 항목**:
- 모든 기본 정보 필드
- 조치 이력 (기존 이력 삭제 후 새로 등록하는 방식)
- 첨부파일:
  - 기존 이미지 삭제 (논리적 삭제)
  - 신규 이미지 추가

**특징**:
- 기존 데이터를 폼에 자동 로드
- 기존 이미지와 신규 이미지를 함께 관리
- 수정 후 지도 및 목록 자동 갱신

### 5. 불법점용 정보 삭제
**기능 설명**: 등록된 불법점용 정보를 논리적으로 삭제합니다. 실제 데이터는 유지하되 조회에서 제외됩니다.

**삭제 범위**:
- 기본 정보 삭제
- 연관된 조치 이력 삭제
- 연관된 첨부파일 삭제

### 6. 지도 시각화 기능
**기능 설명**: 등록된 현장 사진을 지도상에 오버레이로 표시하여 시각적으로 확인할 수 있습니다.

**시각화 기능**:
1. **이미지 레이어 표시**:
   - 등록된 현장 사진을 지도상에 오버레이로 표시
   - 중심점 기준 ±29m 영역에 이미지 표시
   - 사이드 패널의 체크박스로 표시/숨김 제어
   - 여러 이미지를 동시에 표시 가능

2. **영역 하이라이트**:
   - 선택된 토지 영역을 시각적으로 강조
   - 데이터 존재 여부에 따라 색상 구분

3. **사진 비교 지도**:
   - 최대 3개의 지도를 동시에 표시
   - 각 지도에 다른 날짜의 사진을 오버레이
   - 투명도 조절로 비교 분석 가능

---

---

## 🛠️ 기술적 특징 및 구현 포인트

### 1. 이미지 처리 방식
- **클라이언트**: FileReader API로 이미지를 Base64 문자열로 변환
- **서버**: Base64 디코딩 후 파일시스템에 저장
- **저장 경로**: `src/main/resources/static/CDIGIT_CCTV01/attach/extension/illegalLands/`
- **파일명 형식**: `{ilglPrvuInfoSeq}_{timestamp}_{random}.{extension}`

### 2. 날짜-이미지 매핑
- 각 이미지는 촬영일자와 함께 저장
- 같은 날짜에 여러 장의 사진 등록 가능
- 조회 시 날짜별로 그룹화하여 표시

### 3. 지도 통합 기능
- **OpenLayers 3.20.1**: 지도 렌더링 및 상호작용
- **VWorld API**: 연속지적도 레이어 제공
- **좌표계**: EPSG:3857 (Web Mercator)
- **PNU 기반 조회**: 필지번호로 정확한 토지 식별

### 4. 데이터 존재 여부 캐싱
- PNU별 데이터 존재 여부를 캐시하여 성능 최적화
- 깜빡임 방지 및 빠른 UI 반응

### 5. 트랜잭션 관리
- 등록/수정 시 기본정보, 조치이력, 첨부파일이 하나의 트랜잭션으로 처리
- 실패 시 전체 롤백

### 6. 논리적 삭제
- 물리적 삭제 대신 `USE_YN = 'N'` 처리
- 삭제된 데이터는 조회에서 제외되지만 데이터는 보존

---

## 🎨 UI/UX 특징

### 1. 모달 기반 인터페이스
- 등록/수정/조회를 모달로 처리하여 페이지 전환 없이 작업 가능
- ESC 키 또는 외부 클릭으로 닫기 가능

### 2. 시각적 피드백
- **데이터 없음**: 파란색 테두리 + fill (신규 등록 가능)
- **데이터 있음**: 붉은색 테두리 (조회/수정 가능)
- 이미지 미리보기 제공
- 로딩 상태 표시

### 3. 직관적인 조작
- 지도 클릭으로 토지 선택
- 사이드 패널에서 목록 확인 및 빠른 접근
- 드래그 앤 드롭 없이 버튼 클릭으로 이미지 등록

### 4. 반응형 디자인
- 모달 내 스크롤 가능
- 다양한 화면 크기 지원

### 5. 접근성 고려
- ARIA 속성 사용
- 키보드 네비게이션 지원
- 시각적 피드백 제공

---

## 📊 주요 API 엔드포인트

### 등록
- `POST /regions/register` - 불법점용 정보 등록

### 조회
- `GET /regions/list?page=1&size=5` - 페이징 목록 조회
- `GET /regions/details?ilglPrvuInfoSeq={id}` - 상세정보 조회
- `GET /regions/photos?ilglPrvuInfoSeq={id}` - 사진 목록 조회
- `GET /regions/dates?lndsUnqNo={pnu}&type={detail|photo}` - 등록일 리스트 조회
- `GET /regions/photo/{ilglAttflSeq}` - 이미지 파일 제공

### 수정
- `PUT /regions/update?ilglPrvuInfoSeq={id}` - 정보 수정

### 삭제
- `POST /regions/delete?ilglPrvuInfoSeq={id}` - 논리적 삭제

---

## 🚀 향후 개선 가능 사항

1. **검색 기능**: 조건별 검색 (본부, 지사, 노선, 날짜 범위 등)
2. **통계/리포트**: 대시보드, 차트, 엑셀 다운로드
3. **이미지 최적화**: 썸네일 생성, 이미지 압축
4. **권한 관리**: 역할별 접근 제어
5. **알림 기능**: 조치 상태 변경 시 알림
6. **모바일 지원**: 반응형 디자인 강화

---

## 📝 참고 문서

- `ILLEGAL_LAND_LOGIC_KO.md`: 불법점용 용지 관리 모듈 로직 명세서
- `dbInfo.sql`: 데이터베이스 스키마 정의

---

이 문서는 프로젝트의 목적과 주요 기능을 이해하기 위한 참고 자료입니다. 실제 개발 시 이 문서를 기반으로 작업을 진행하시면 됩니다.



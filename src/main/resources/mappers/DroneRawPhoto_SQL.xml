<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.toji.toji.mapper.DroneRawPhotoMapper">

    <resultMap id="droneRawPhotoResultMap" type="com.toji.toji.domain.DroneRawPhotoVO">
        <id property="photoSeq" column="PHOTO_SEQ" />
        <result property="flightId" column="FLIGHT_ID" />
        <result property="shootDt" column="SHOOT_DT" />
        <result property="filePath" column="FILE_PATH" />
        <result property="fileNm" column="FILE_NM" />
        <result property="gpsLat" column="GPS_LAT" />
        <result property="gpsLon" column="GPS_LON" />
    </resultMap>

    <insert id="insertRawPhoto" parameterType="com.toji.toji.domain.DroneRawPhotoVO">
        <selectKey keyProperty="photoSeq" resultType="long" order="BEFORE">
            SELECT DTJ_MAIN.SEQ_DRONE_RAW_PHOTO.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO DTJ_MAIN.T_DRONE_RAW_PHOTO (
            PHOTO_SEQ,
            FLIGHT_ID,
            SHOOT_DT,
            FILE_PATH,
            FILE_NM,
            GPS_LAT,
            GPS_LON
        ) VALUES (
            #{photoSeq},
            #{flightId},
            #{shootDt},
            #{filePath},
            #{fileNm},
            #{gpsLat},
            #{gpsLon}
        )
    </insert>

    <select id="selectRawPhotosByDate" resultMap="droneRawPhotoResultMap">
        SELECT
            PHOTO_SEQ,
            FLIGHT_ID,
            SHOOT_DT,
            FILE_PATH,
            FILE_NM,
            GPS_LAT,
            GPS_LON
        FROM DTJ_MAIN.T_DRONE_RAW_PHOTO
        WHERE TO_CHAR(SHOOT_DT, 'YYYY-MM-DD') = #{date}
    </select>

    <select id="selectDistinctDates" resultType="string">
        SELECT DISTINCT TO_CHAR(SHOOT_DT, 'YYYY-MM-DD') as shootDate
        FROM DTJ_MAIN.T_DRONE_RAW_PHOTO
        WHERE SHOOT_DT IS NOT NULL
        ORDER BY shootDate DESC
    </select>

    <select id="selectRawPhotoById" resultMap="droneRawPhotoResultMap">
        SELECT
            PHOTO_SEQ,
            FLIGHT_ID,
            SHOOT_DT,
            FILE_PATH,
            FILE_NM,
            GPS_LAT,
            GPS_LON
        FROM DTJ_MAIN.T_DRONE_RAW_PHOTO
        WHERE PHOTO_SEQ = #{photoSeq}
    </select>

</mapper>

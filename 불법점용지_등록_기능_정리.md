# 불법점용지 등록 기능 정리

## 1. 기본 내용 등록

### 어떤 값
- 본부, 지사, 노선명, 발생일자 등 폼 입력값
- GPS 좌표 (경도, 위도)
- 필지번호 (PNU)
- 조치 이력 목록

### 어떻게 처리
- 폼에서 데이터 수집 → JSON 객체로 변환 → 서버로 전송
- 필수 필드 유효성 검사 후 전송

### 사용 기술
- **프론트엔드**: JavaScript (jQuery) - `collectFormData()` 함수
- **백엔드**: Spring Boot REST API - `POST /regions/register`
- **데이터 형식**: JSON (Content-Type: application/json)

### 코드 위치
```javascript
// 프론트: register.js
collectFormData() → submitRegister() → $.ajax POST

// 백엔드: RegionController.java
@PostMapping("/regions/register")
```

---

## 2. 사진 등록

### 어떤 값
- 이미지 파일 (PNG, JPG)
- 촬영일자 (날짜)

### 어떻게 처리

**프론트엔드:**
1. 파일 선택 → `FileReader` API로 Base64 인코딩
2. 날짜와 매핑: `"날짜:Base64데이터"` 형식으로 저장
3. JSON에 포함: `files.images[]` 배열에 Base64 문자열 포함

**백엔드:**
1. Base64 디코딩 → 바이트 배열 변환
2. 파일 저장: NAS 경로에 실제 파일 저장 (`/CDIGIT_CCTV01/attach/extension/illegalLands`)
3. DB 메타데이터 저장: 파일명, 경로, 크기, 촬영일자 등 저장

### 사용 기술
- **프론트엔드**: 
  - `FileReader` API - 파일을 Base64로 변환
  - JavaScript - 파일 읽기 및 인코딩
- **백엔드**: 
  - Java `Base64.getDecoder()` - Base64 디코딩
  - Java NIO `Files`, `FileOutputStream` - 파일 저장
  - MyBatis - DB 저장

### 저장 형식
- **파일**: NAS 경로에 실제 이미지 파일 저장
- **DB**: 파일명, 경로, 크기, 촬영일자 등 메타데이터만 저장

### 코드 위치
```javascript
// 프론트: register.js
handleFileSelect() → fileToBase64() → 날짜:Base64 매핑

// 백엔드: RegionServiceImpl.java
insertAttachments() → Base64 디코딩 → 파일 저장 → DB 저장
```

---

## 3. 전체 등록 흐름

```
1. 사용자 입력 (폼 + 이미지)
   ↓
2. 프론트엔드: 데이터 수집 및 변환
   - 기본 정보 → JSON 객체
   - 이미지 → Base64 인코딩 → JSON에 포함
   ↓
3. Ajax 요청: POST /regions/register (JSON)
   ↓
4. 백엔드: 데이터 처리
   - 기본 정보 → DB 저장
   - Base64 이미지 → 디코딩 → 파일 저장 → DB 메타데이터 저장
   ↓
5. 완료: 등록 ID 반환
```

---

## 4. 주요 API

- **등록**: `POST /regions/register` (JSON Body)
- **이미지 조회**: `GET /regions/photo/{ilglAttflSeq}` (파일 경로에서 제공)

